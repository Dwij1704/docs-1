---
title: "Advanced Custom Tools"
description: "Learn how to create sophisticated custom tools for your AI agents"
---

# Building Advanced Custom Tools

Learn how to create powerful, sophisticated tools to extend your AI agents' capabilities.

## Prerequisites

Make sure you have:
- Completed the basic tools tutorial
- Understanding of TypeScript/JavaScript
- xpander.ai SDK installed

## Tool Architecture

<CardGroup cols={2}>
  <Card title="Tool Interface" icon="code">
    Define tool structure and behavior
  </Card>
  
  <Card title="Tool Implementation" icon="gears">
    Implement tool functionality
  </Card>
</CardGroup>

## Advanced Tool Structure

```typescript
interface AdvancedTool {
  name: string;
  description: string;
  version: string;
  inputSchema: JSONSchema;
  outputSchema: JSONSchema;
  function: (input: any) => Promise<any>;
  middleware?: ToolMiddleware[];
  rateLimit?: RateLimitConfig;
  cache?: CacheConfig;
  errorHandling?: ErrorHandlingConfig;
}
```

## Input Validation with JSON Schema

```typescript
const calculatorSchema = {
  type: 'object',
  properties: {
    operation: {
      type: 'string',
      enum: ['add', 'subtract', 'multiply', 'divide']
    },
    numbers: {
      type: 'array',
      items: { type: 'number' },
      minItems: 2
    },
    precision: {
      type: 'number',
      default: 2
    }
  },
  required: ['operation', 'numbers']
};

const tool = await agent.createTool({
  name: 'advancedCalculator',
  inputSchema: calculatorSchema,
  // ... implementation
});
```

## Middleware System

```typescript
// Create middleware
const loggingMiddleware = async (input, next) => {
  console.log('Input:', input);
  const result = await next(input);
  console.log('Output:', result);
  return result;
};

const validationMiddleware = async (input, next) => {
  if (!input.numbers.every(n => isFinite(n))) {
    throw new Error('Invalid numbers');
  }
  return next(input);
};

// Apply middleware
const tool = await agent.createTool({
  name: 'calculator',
  middleware: [loggingMiddleware, validationMiddleware],
  function: async (input) => {
    // Tool implementation
  }
});
```

## Caching and Rate Limiting

```typescript
const tool = await agent.createTool({
  name: 'weatherAPI',
  cache: {
    type: 'redis',
    ttl: '5m',
    maxSize: '100mb'
  },
  rateLimit: {
    maxRequests: 100,
    perTimeWindow: '1m',
    strategy: 'token-bucket'
  },
  function: async (input) => {
    // Implementation
  }
});
```

## Error Handling and Retries

```typescript
const tool = await agent.createTool({
  name: 'databaseQuery',
  errorHandling: {
    retry: {
      maxAttempts: 3,
      backoff: 'exponential',
      initialDelay: 1000
    },
    fallback: async (error, input) => {
      // Fallback implementation
      return backupData;
    }
  },
  function: async (input) => {
    // Implementation
  }
});
```

## State Management

```typescript
class StatefulTool {
  private state: Map<string, any>;

  constructor() {
    this.state = new Map();
  }

  async execute(input) {
    const currentState = this.state.get(input.context) || {};
    // Process with state
    this.state.set(input.context, newState);
    return result;
  }
}

const tool = await agent.createTool({
  name: 'statefulProcessor',
  instance: new StatefulTool(),
  function: (input) => instance.execute(input)
});
```

## Complete Example

```typescript
import { 
  XpanderClient, 
  ToolBuilder,
  Middleware,
  Cache,
  RateLimit 
} from '@xpander/sdk';

async function createAdvancedTool() {
  // Create tool builder
  const builder = new ToolBuilder('advancedTool');

  // Add schemas
  builder.setInputSchema({
    type: 'object',
    properties: {
      // Schema definition
    }
  });

  // Add middleware
  builder.addMiddleware([
    loggingMiddleware,
    validationMiddleware
  ]);

  // Configure caching
  builder.setCache({
    type: 'redis',
    ttl: '5m'
  });

  // Add rate limiting
  builder.setRateLimit({
    maxRequests: 100,
    perTimeWindow: '1m'
  });

  // Implement function
  builder.setFunction(async (input) => {
    // Implementation
  });

  // Build the tool
  const tool = await builder.build();

  // Add to agent
  await agent.addTool(tool);

  return tool;
}
```

## Testing Tools

<CardGroup cols={2}>
  <Card title="Unit Testing" icon="vial">
    ```typescript
    describe('Advanced Tool', () => {
      it('validates input', async () => {
        const result = await tool.execute({
          operation: 'add',
          numbers: [1, 2]
        });
        expect(result).toBeDefined();
      });
    });
    ```
  </Card>
  
  <Card title="Integration Testing" icon="vials">
    ```typescript
    describe('Tool Integration', () => {
      it('works with agent', async () => {
        const response = await agent.chat({
          message: 'Use the tool'
        });
        expect(response).toBeDefined();
      });
    });
    ```
  </Card>
</CardGroup>

## Best Practices

<CardGroup cols={2}>
  <Card title="Input Validation" icon="check-double">
    Always validate inputs with JSON Schema
  </Card>
  
  <Card title="Error Handling" icon="shield">
    Implement comprehensive error handling
  </Card>
  
  <Card title="Performance" icon="gauge">
    Use caching and rate limiting
  </Card>
  
  <Card title="Testing" icon="flask">
    Write thorough tests for your tools
  </Card>
</CardGroup>

## Next Steps

<CardGroup cols={2}>
  <Card 
    title="State Management" 
    icon="diagram-project"
    href="/tutorials/advanced/state-management"
  >
    Learn advanced state management
  </Card>
  
  <Card 
    title="Multi-Agent Systems" 
    icon="network-wired"
    href="/tutorials/advanced/multi-agent"
  >
    Build complex agent systems
  </Card>
</CardGroup> 