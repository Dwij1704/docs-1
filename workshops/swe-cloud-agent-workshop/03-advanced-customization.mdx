---
title: "Module 3: Advanced Customization"
description: "Run the agent loop locally via a notebook"
icon: "gear"
---

<Note>

### **Module Summary**

- **Goal**: Customize agent loops, add Python tools, and run the agent locally
- **Prerequisites**: Python 3.12, Node.js v22

</Note>

---

## What you'll do in This module

In this module, you‚Äôll gain full control over your agent‚Äôs behavior.

You‚Äôll learn how to:

- Run your agent locally via a Jupyter notebook.
- Customize the agent loop, allowing advanced logic or prompt shaping
- Add your own Python tools to expand what the agent can do


## Environment Setup

| Tool    | Required Version |
| ------- | ---------------- |
| Python  | `3.12.7`         |
| Node.js | `v22`            |

Use `pyenv` and `nvm` to manage these versions if needed:

```bash
python3 --version     # 3.12.7
node --version        # v22.x
````
## Clone the template repository

```bash
git clone https://github.com/xpander-ai/xpander.ai.git
cd xpander.ai/Getting-Started/hello-world
python3 -m venv .venv
source .venv/bin/activate
```

## CLI Login & Agent Initialization

Install the CLI and initialize your agent:

```bash
npm i -g xpander-cli
xpander login
xpander initialize
```
To get the Agent ID of your SWE agent for the initialization part:
1. Go back to the AI Workbench
2. Click the "SDK" trigger node, at the top part of the canvas
3. Copy the Agent ID from there, and paste it in the CLI prompt

![swe cli init](/images/workshops/swe-cli-login-and-init.png)

This creates the following files:

* `xpander_config.json`
* `agent_instructions.json`
* `requirements.txt`


## Install agent dependencies

```bash
pip install -r requirements.txt
mv .env.example .env
```

Fill in the required values in `.env`:

<Tip>
If you're running the workshop in an event, get the OpenAI key from the event's Notes file, or use your own key.
</Tip>

```env
OPENAI_MODEL_ID=gpt-4.1
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## Run the agent via a Jupyter notebook.

Here, we'll step through the agent lifecycle.
Open `my_agent.ipynb` in VSCode, Cursor, Jupyter Lab, or any notebook viewer.

![swe notebook](/images/workshops/swe-notebook.png)


## Add Local Tools

Define a custom tool in `tools/local_tools.py`:

```python
def say_hello(name: str) -> dict:
    return {"message": f"Hello {name}, welcome to the workshop!"}

local_tools = [
    {
        "declaration": {
            "type": "function",
            "function": {
                "name": "say_hello",
                "description": "Greets the user",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "name": {"type": "string", "description": "User's name"}
                    },
                    "required": ["name"]
                }
            }
        },
        "fn": say_hello
    }
]
```

Register in `my_agent.py`:

```python
self.agent.add_local_tools([tool["declaration"] for tool in local_tools])
```

---

## Customize the agent loop

Modify the main loop in `my_agent.py`:

```python
async def _agent_loop(self):
    # Customize execution, prompt shaping, logging, etc.
```

Customize:

* Prompt rewriting
* Token usage tracking
* Advanced condition handling
* Custom logging or retry mechanisms

---



## üßØ Troubleshooting

| Issue                    | Fix                                                          |
| ------------------------ | ------------------------------------------------------------ |
| `Failed to sync agent`   | Re-check `.env` and `xpander_config.json` and re-run init    |
| `add_graph_item` errors  | Confirm a clean tool graph and valid agent ID                |
| BrokenPipe / JSII issues | Restart shell or rebuild `.venv`                             |
| No event triggers        | Only run `xpander_handler.py` after triggering from frontend |

---

## ‚úÖ Summary

| Feature            | Benefit                                |
| ------------------ | -------------------------------------- |
| üß† Custom Logic    | Full control with `_agent_loop()`      |
| üõ† Tooling         | Add Python tools as callable functions |
| üß≤ Hybrid Mode     | Local + Cloud support                  |
| üîç Insights        | Built-in metrics and logs              |
