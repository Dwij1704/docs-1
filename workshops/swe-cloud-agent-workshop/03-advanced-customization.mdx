---
title: "Module 3: Advanced Customization"
description: "Run your own agent loop, add tools and optionally deploy with Xpander CLI"
icon: "gear"
---

<Note>

### **Module Summary**

- **Goal**: Customize agent loops, add Python tools, and run the agent locally or via cloud event hook
- **Estimated Time**: 45‚Äì60 minutes
- **Prerequisites**: Python 3.12, Node.js v22, completed Modules 1‚Äì3

</Note>

---

## üß≠ What You'll Do in This Module

In this module, you‚Äôll gain **full control** over your agent‚Äôs behavior.

You‚Äôll learn how to:

- Run your agent locally via **Notebook**, **CLI**, or **event handler**
- Customize the **agent loop**, allowing advanced logic or prompt shaping
- Add **your own Python tools** to expand what the agent can do
- Optionally deploy the agent using the **xpander.ai CLI** for cloud-based execution

By the end, you‚Äôll be able to create and extend fully working agents tailored to your needs - whether you want to explore behavior in a notebook or power up a frontend integration.

Let‚Äôs get started.

---

## ‚öôÔ∏è Environment Setup

This setup is required for **all run modes** (Notebook, CLI, Event-driven):

| Tool    | Required Version |
| ------- | ---------------- |
| Python  | `3.12.7`         |
| Node.js | `v22`            |

Use `pyenv` and `nvm` to manage these versions if needed:

```bash
python3 --version     # 3.12.7
node --version        # v22.x
````

---

## üß± Step 1: Clone the Template Repository

```bash
git clone https://github.com/xpander-ai/xpander.ai.git
cd xpander.ai/Getting-Started/hello-world
python3 -m venv .venv
source .venv/bin/activate
```

---

## üîê Step 2: CLI Login & Agent Initialization

Install the CLI and initialize your agent:

```bash
npm i -g xpander-cli
xpander login
xpander initialize
```

This creates the following files:

* `xpander_config.json`
* `agent_instructions.json`
* `requirements.txt`

![swe cli init](/images/workshops/swe-cli-login-and-init.png)

---

## üì¶ Step 3: Install Agent Dependencies

```bash
pip install -r requirements.txt
mv .env.example .env
```

Fill in the required values in `.env`:

```env
OPENAI_MODEL_ID=gpt-4.1
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## üí¨ Step 4: Run the Agent

### Option A: Notebook Mode (Recommended for Exploration)

This mode is ideal for stepping through the agent lifecycle.

#### ‚ñ∂Ô∏è 1. Open the Notebook

Open `my_agent.ipynb` in VSCode, Jupyter Lab, or any notebook viewer.

![swe notebook](/images/workshops/swe-notebook.png)

#### üß™ 2. Import Libraries

Run this cell first:

```python
from xpander_sdk import XpanderClient, Agent
from my_agent import MyAgent
from dotenv import load_dotenv
import json
```

#### üîß 3. Load Configuration

```python
load_dotenv()

with open('xpander_config.json', 'r') as config_file:
    xpander_config = json.load(config_file)
```

#### üß† 4. Initialize and Wrap the Agent

```python
xpander_client = XpanderClient(api_key=xpander_config.get("api_key"))
xpander_agent = xpander_client.agents.get(agent_id=xpander_config.get("agent_id"))
agent = MyAgent(xpander_agent)
```

#### üí¨ 5. Send a Task to the Agent

```python
thread = await agent.chat("Add a simple, beautiful Shazam-style app (HTML, CSS, JS) to xpander-ai/apps-by-agents.")
```

#### üìä 6. Retrieve and Display Result

```python
execution_result = xpander_agent.retrieve_execution_result()
print("status:", execution_result.status.value)
print("result:", execution_result.result)
```

![swe task result](/images/workshops/swe-coding-task-result.png)

#### üßæ 7. Visualize Message History (Optional)

```python
from tabulate import tabulate

messages = xpander_agent.messages
for msg in messages:
    print(msg["role"], ":", msg["content"][:100])
```

![swe task messages](/images/workshops/swe-coding-task-messages.png)

---

### Option B: CLI Mode

Run the agent directly via:

```bash
python app.py
```

Then send a prompt like:

```text
Create a responsive Agents Directory app (HTML, CSS, JS) with mock agents and PR to xpander-ai/apps-by-agents.
```

![swe cli](/images/workshops/swe-coding-cli.png)

---

### Option C: Event-Driven Mode

Run the event handler script for live frontend integration:

```bash
python xpander_handler.py
```

![swe coding handler](/images/workshops/swe-coding-handler.png)

---

## üîß Step 5: Add Local Tools

Define a custom tool in `tools/local_tools.py`:

```python
def say_hello(name: str) -> dict:
    return {"message": f"Hello {name}, welcome to the workshop!"}

local_tools = [
    {
        "declaration": {
            "type": "function",
            "function": {
                "name": "say_hello",
                "description": "Greets the user",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "name": {"type": "string", "description": "User's name"}
                    },
                    "required": ["name"]
                }
            }
        },
        "fn": say_hello
    }
]
```

Register in `my_agent.py`:

```python
self.agent.add_local_tools([tool["declaration"] for tool in local_tools])
```

---

## üß† Step 6: Customize the Agent Loop

Modify the main loop in `my_agent.py`:

```python
async def _agent_loop(self):
    # Customize execution, prompt shaping, logging, etc.
```

Customize:

* Prompt rewriting
* Token usage tracking
* Advanced condition handling
* Custom logging or retry mechanisms

---

## üöÄ Step 7: Deploy to Cloud

Use Xpander CLI to deploy your agent:

```bash
xpander deploy
```

![swe xpander deploy](/images/workshops/xpander-deploy.png)

View live logs:

```bash
xpander logs
```

---

## üßØ Troubleshooting

| Issue                    | Fix                                                          |
| ------------------------ | ------------------------------------------------------------ |
| `Failed to sync agent`   | Re-check `.env` and `xpander_config.json` and re-run init    |
| `add_graph_item` errors  | Confirm a clean tool graph and valid agent ID                |
| BrokenPipe / JSII issues | Restart shell or rebuild `.venv`                             |
| No event triggers        | Only run `xpander_handler.py` after triggering from frontend |

---

## ‚úÖ Summary

| Feature            | Benefit                                |
| ------------------ | -------------------------------------- |
| üß† Custom Logic    | Full control with `_agent_loop()`      |
| üõ† Tooling         | Add Python tools as callable functions |
| üß≤ Hybrid Mode     | Local + Cloud support                  |
| üì¶ One-Line Deploy | `xpander deploy` ready                 |
| üîç Insights        | Built-in metrics and logs              |